SELECT CASE WHEN RTrim(xmlagg(xmlelement(e,' USUARIO TRAVADOR: '||h.session_id||' | '||ub.serial#||' | '||ub.username||' ||| USUARIO ESPERANDO: '||w.session_id||' | '||uw.serial#||' | '||uw.username,Chr(10)).extract('//text()')),';') <> chr(10) THEN RTrim(xmlagg(xmlelement(e,' USUARIO TRAVADOR: '||h.session_id||' | '||ub.serial#||' | '||ub.username||' |-|-| USUARIO ESPERANDO: '||w.session_id||' | '||uw.serial#||' | '||uw.username,Chr(10)).extract('//text()')),';') ELSE 'none' END locks FROM dba_locks w, dba_locks h, v$session ub, v$session uw WHERE h.blocking_others = 'Blocking' AND h.mode_held != 'None' AND h.mode_held != 'Null' AND h.session_id = ub.sid AND w.mode_requested != 'None' AND w.lock_type  = h.lock_type AND w.lock_id1  = h.lock_id1 AND w.lock_id2 = h.lock_id2 AND w.session_id = uw.sid;